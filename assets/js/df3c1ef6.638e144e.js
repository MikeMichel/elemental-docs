"use strict";(self.webpackChunkelemental_docs=self.webpackChunkelemental_docs||[]).push([[3068],{3905:(e,a,t)=>{t.d(a,{Zo:()=>d,kt:()=>g});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=n.createContext({}),m=function(e){var a=n.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},d=function(e){var a=m(e.components);return n.createElement(i.Provider,{value:a},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=m(t),u=r,g=p["".concat(i,".").concat(u)]||p[u]||c[u]||o;return t?n.createElement(g,l(l({ref:a},d),{},{components:t})):n.createElement(g,l({ref:a},d))}));function g(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=u;var s={};for(var i in a)hasOwnProperty.call(a,i)&&(s[i]=a[i]);s.originalType=e,s[p]="string"==typeof e?e:r,l[1]=s;for(var m=2;m<o;m++)l[m]=t[m];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},7576:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>g,contentTitle:()=>c,default:()=>O,frontMatter:()=>p,metadata:()=>u,toc:()=>h});var n=t(7462),r=(t(7294),t(3905)),o=t(4298),l=t(1230),s=t(5130),i=t(9992),m=t(8139),d=t(460);const p={sidebar_label:"Upgrade",title:""},c="Upgrade",u={unversionedId:"upgrade",id:"version-stable/upgrade",title:"",description:"All components in Elemental are managed using Kubernetes. Below is how",source:"@site/versioned_docs/version-stable/upgrade.md",sourceDirName:".",slug:"/upgrade",permalink:"/upgrade",draft:!1,tags:[],version:"stable",frontMatter:{sidebar_label:"Upgrade",title:""},sidebar:"docs",previous:{title:"Installation",permalink:"/installation"},next:{title:"Custom Images",permalink:"/customizing"}},g={},h=[{value:"Elemental Teal node upgrade",id:"elemental-teal-node-upgrade",level:2},{value:"Selecting source for upgrade",id:"selecting-source-for-upgrade",level:3},{value:"Managing available versions",id:"managing-available-versions",level:3}],y=e=>function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",a)},b=y("Vars"),v=y("Tabs"),f=y("TabItem"),k=y("CodeBlock"),w={toc:h},T="wrapper";function O(e){let{components:a,...t}=e;return(0,r.kt)(T,(0,n.Z)({},w,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"upgrade"},"Upgrade"),(0,r.kt)("p",null,"All components in Elemental are managed using Kubernetes. Below is how\nto use Kubernetes approaches to upgrade the components."),(0,r.kt)("h2",{id:"elemental-teal-node-upgrade"},"Elemental Teal node upgrade"),(0,r.kt)("p",null,"Elemental Teal is upgraded with the ",(0,r.kt)(b,{name:"elemental_operator_name",mdxType:"Vars"}),". Refer to the\n",(0,r.kt)("a",{parentName:"p",href:"/elementaloperatorchart-reference"},(0,r.kt)(b,{name:"elemental_operator_name",mdxType:"Vars"}))," documentation for complete information."),(0,r.kt)("p",null,"There are two ways of selecting nodes for upgrading. Via a cluster target, which will match ALL nodes in a cluster that matches our\nselector or via node selector, which will match nodes based on the node labels. Node selector allows us to be more targeted with the upgrade\nwhile cluster selector just selects all the nodes in a matched cluster."),(0,r.kt)(v,{mdxType:"Tabs"},(0,r.kt)(f,{value:"clusterTarget",label:"With 'clusterTarget'",default:!0,mdxType:"TabItem"},"You can target nodes for an upgrade via a `clusterTarget` by setting it to the cluster name that you want to upgrade. All nodes in a cluster that matches that name will match and be upgraded.",(0,r.kt)(k,{language:"yaml",title:"upgrade-cluster-target.yaml",showLineNumbers:!0,mdxType:"CodeBlock"},o.Z)),(0,r.kt)(f,{value:"nodeSelector",label:"With nodeSelector",mdxType:"TabItem"},"You can target nodes for an upgrade via a `nodeSelector` by setting it to the label and value that you want to match. Any nodes containing that key with the value will match and be upgraded.",(0,r.kt)(k,{language:"yaml",title:"upgrade-node-selector.yaml",showLineNumbers:!0,mdxType:"CodeBlock"},l.Z))),(0,r.kt)("h3",{id:"selecting-source-for-upgrade"},"Selecting source for upgrade"),(0,r.kt)(v,{mdxType:"Tabs"},(0,r.kt)(f,{value:"osImage",label:"Via 'osImage'",mdxType:"TabItem"},(0,r.kt)("p",null,"Just specify an OCI image on the ",(0,r.kt)("inlineCode",{parentName:"p"},"osImage")," field"),(0,r.kt)(k,{language:"yaml",title:"upgrade-cluster-target.yaml",showLineNumbers:!0,mdxType:"CodeBlock"},o.Z)),(0,r.kt)(f,{value:"managedOSVersion",label:"Via 'ManagedOSVersion'",mdxType:"TabItem"},(0,r.kt)("p",null,"In this case we use the auto populated ",(0,r.kt)("inlineCode",{parentName:"p"},"ManagedOSVersion")," resources to set the wanted ",(0,r.kt)("inlineCode",{parentName:"p"},"managedOSVersionName")," field.\nSee section ",(0,r.kt)("a",{parentName:"p",href:"#managing-available-versions"},"Managing available versions")," to understand how the ",(0,r.kt)("inlineCode",{parentName:"p"},"ManagedOSVersion")," are managed."),(0,r.kt)(k,{language:"yaml",title:"upgrade-managedos-version.yaml",showLineNumbers:!0,mdxType:"CodeBlock"},s.Z))),(0,r.kt)("admonition",{title:"Warning",type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"If both ",(0,r.kt)("inlineCode",{parentName:"p"},"osImage")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"ManagedOSVersion")," are defined in the same ",(0,r.kt)("inlineCode",{parentName:"p"},"ManagedOSImage")," be aware that ",(0,r.kt)("inlineCode",{parentName:"p"},"osImage")," takes precedence.")),(0,r.kt)("h3",{id:"managing-available-versions"},"Managing available versions"),(0,r.kt)("p",null,"An ",(0,r.kt)("inlineCode",{parentName:"p"},"ManagedOSVersionChannel")," resource can be created in a Kubernetes cluster where the Elemental operator is installed to synchronize available versions for upgrades."),(0,r.kt)("p",null,"It has a syncer in order to generate ",(0,r.kt)("inlineCode",{parentName:"p"},"ManagedOSVersion")," automatically. Currently, we provide a json syncer and a custom one."),(0,r.kt)(v,{mdxType:"Tabs"},(0,r.kt)(f,{value:"jsonSyncer",label:"Json syncer",mdxType:"TabItem"},(0,r.kt)("p",null,"This syncer will fetch a json from url and parse it into valid ",(0,r.kt)("inlineCode",{parentName:"p"},"ManagedOSVersion")," resources."),(0,r.kt)(k,{language:"yaml",title:"managed-os-version-json",showLineNumbers:!0,mdxType:"CodeBlock"},i.Z)),(0,r.kt)(f,{value:"customSyncer",label:"Custom syncer",mdxType:"TabItem"},(0,r.kt)("p",null,"A custom syncer allows more flexibility on how to gather ",(0,r.kt)("inlineCode",{parentName:"p"},"ManagedOSVersion")," by allowing custom commands with custom images."),(0,r.kt)("p",null,"This type of syncer allows to run a given command with arguments and env vars in a custom image and output a json file to ",(0,r.kt)("inlineCode",{parentName:"p"},"/data/output"),".\nThe generated data is then automounted by the syncer and then parsed so it can gather create the proper versions."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The only requirement to make your own custom syncer is to make it output a json file to ",(0,r.kt)("inlineCode",{parentName:"p"},"/data/output")," and keep the correct json structure.")),(0,r.kt)("p",null,"See below for an example use of our ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rancher-sandbox/upgradechannel-discovery"},"discovery plugin"),",\nwhich gathers versions from either git or github releases."),(0,r.kt)(k,{language:"yaml",title:"managed-os-version-channel-json.yaml",showLineNumbers:!0,mdxType:"CodeBlock"},m.Z))),(0,r.kt)("p",null,"In both cases the file that the operator expects to parse is a json file with the versions on it as follows"),(0,r.kt)(k,{language:"json",title:"versions.json",showLineNumbers:!0,mdxType:"CodeBlock"},d.Z))}O.isMDXComponent=!0},8139:(e,a,t)=>{t.d(a,{Z:()=>n});const n="apiVersion: elemental.cattle.io/v1beta1\nkind: ManagedOSVersionChannel\nmetadata:\n  name: elemental-teal-channel\n  namespace: fleet-default\nspec:\n  options:\n    image: registry.opensuse.org/isv/rancher/elemental/stable/teal53/15.4/rancher/elemental-teal-channel/5.3:latest\n  type: custom\n"},9992:(e,a,t)=>{t.d(a,{Z:()=>n});const n='apiVersion: elemental.cattle.io/v1beta1\nkind: ManagedOSVersionChannel\nmetadata:\n  name: elemental-versions\n  namespace: fleet-default\nspec:\n  options:\n    URI: "https://raw.githubusercontent.com/rancher/elemental-docs/main/examples/upgrade/versions.json"\n    Timeout: "1m"\n  type: json'},4298:(e,a,t)=>{t.d(a,{Z:()=>n});const n='apiVersion: elemental.cattle.io/v1beta1\nkind: ManagedOSImage\nmetadata:\n  name: my-upgrade\n  namespace: fleet-default\nspec:\n  # Set to the new Elemental version you would like to upgrade to or track the latest tag\n  osImage: "registry.opensuse.org/isv/rancher/elemental/teal52/15.3/rancher/elemental-node-image/5.2:latest"\n  clusterTargets:\n    - clusterName: my-cluster'},5130:(e,a,t)=>{t.d(a,{Z:()=>n});const n="apiVersion: elemental.cattle.io/v1beta1\nkind: ManagedOSImage\nmetadata:\n  name:  my-upgrade\n  namespace: fleet-default\nspec:\n  # Set to the new ManagedOSVersion you would like to upgrade to\n  managedOSVersionName: v0.1.0-alpha22-amd64\n  clusterTargets:\n    - clusterName: my-cluster"},1230:(e,a,t)=>{t.d(a,{Z:()=>n});const n='apiVersion: elemental.cattle.io/v1beta1\nkind: ManagedOSImage\nmetadata:\n  name: my-upgrade\n  namespace: fleet-default\nspec:\n  # Set to the new Elemental version you would like to upgrade to\n  osImage: "registry.opensuse.org/isv/rancher/elemental/teal52/15.3/rancher/elemental-node-image/5.2:latest"\n  clusterTargets:\n    - clusterName: my-cluster\n  nodeSelector:\n    matchLabels:\n      kubernetes.io/hostname: my-machine\n'},460:(e,a,t)=>{t.d(a,{Z:()=>n});const n='[\n  {\n    "metadata": {\n      "name": "v0.1.0"\n    },\n    "spec": {\n      "version": "v0.1.0",\n      "type": "container",\n      "metadata": {\n        "upgradeImage": "foo/bar:v0.1.0"\n      }\n    }\n  },\n  {\n    "metadata": {\n      "name": "v0.2.0"\n    },\n    "spec": {\n      "version": "v0.2.0",\n      "type": "container",\n      "metadata": {\n        "upgradeImage": "foo/bar:v0.2.0"\n      }\n    }\n  }\n]'}}]);